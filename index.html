<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shooter Game V2</title>
    <style>
        body {
            margin: 0;
            background-color: #111;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            color: white;
            font-family: 'Courier New', Courier, monospace;
            overflow: hidden;
        }
        canvas {
            background-color: #000;
            border: 2px solid #333;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.2);
        }
        #ui {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            pointer-events: none;
            width: 100%;
        }
        .status {
            font-size: 18px;
            color: #ffff00;
            margin-top: 5px;
        }
    </style>
</head>
<body>

    <div id="ui">
        <h1>SHOOTER JS V2</h1>
        <h2 id="scoreBoard">SCORE: 0</h2>
        <div id="statusBoard" class="status">LEVEL 1: MAX 5 SHOTS</div>
    </div>
    <canvas id="gameCanvas" width="800" height="450"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreBoard = document.getElementById('scoreBoard');
    const statusBoard = document.getElementById('statusBoard');

    // „Ç≤„Éº„É†„ÅÆÁä∂ÊÖã
    let score = 0;
    let gameOver = false;
    let frameCount = 0;

    // „Ç≠„ÉºÂÖ•ÂäõÁÆ°ÁêÜ
    const keys = {
        ArrowUp: false,
        ArrowDown: false,
        ArrowLeft: false,
        ArrowRight: false,
        " ": false
    };

    document.addEventListener('keydown', (e) => {
        if (keys.hasOwnProperty(e.key)) keys[e.key] = true;
        if (gameOver && e.key === " ") location.reload();
    });

    document.addEventListener('keyup', (e) => {
        if (keys.hasOwnProperty(e.key)) keys[e.key] = false;
    });

    // „Éó„É¨„Ç§„É§„ÉºÔºàËá™Ê©üÔºâ„ÇØ„É©„Çπ
    class Player {
        constructor() {
            this.width = 40;
            this.height = 20;
            this.x = 50;
            this.y = canvas.height / 2 - this.height / 2;
            this.speed = 5;
            this.color = '#00ffcc';
            this.bulletTimer = 0;
            
            // „Éë„ÉØ„Éº„Ç¢„ÉÉ„ÉóÈñ¢ÈÄ£
            this.maxBullets = 5; // ÂàùÊúüÂºæÊï∞Âà∂Èôê
            this.powerLevel = 0; // 0:ÂàùÊúü, 1:ÂºæÊï∞Â¢ó, 2:3WAY
        }

        update() {
            // ÁßªÂãï
            if (keys.ArrowUp && this.y > 0) this.y -= this.speed;
            if (keys.ArrowDown && this.y + this.height < canvas.height) this.y += this.speed;
            if (keys.ArrowLeft && this.x > 0) this.x -= this.speed;
            if (keys.ArrowRight && this.x + this.width < canvas.width) this.x += this.speed;

            // Áô∫Â∞ÑÂá¶ÁêÜ
            if (keys[" "]) {
                if (this.bulletTimer <= 0) {
                    // ÁîªÈù¢ÂÜÖ„ÅÆÂºæÊï∞„ÉÅ„Çß„ÉÉ„ÇØ
                    if (bullets.length < this.maxBullets) {
                        this.shoot();
                        this.bulletTimer = 15; // ÈÄ£Â∞ÑÈñìÈöîÔºàÂ∞ë„Åó„ÇÜ„Å£„Åè„Çä„Å´Ôºâ
                    }
                }
            }
            if (this.bulletTimer > 0) this.bulletTimer--;
        }

        shoot() {
            // „É¨„Éô„É´2: 3WAY„Ç∑„Éß„ÉÉ„Éà
            if (this.powerLevel >= 2) {
                bullets.push(new Bullet(this.x + this.width, this.y + this.height / 2, 0)); // Áõ¥ÈÄ≤
                bullets.push(new Bullet(this.x + this.width, this.y + this.height / 2, -3)); // Êñú„ÇÅ‰∏ä
                bullets.push(new Bullet(this.x + this.width, this.y + this.height / 2, 3));  // Êñú„ÇÅ‰∏ã
            } else {
                // ÈÄöÂ∏∏„Ç∑„Éß„ÉÉ„Éà
                bullets.push(new Bullet(this.x + this.width, this.y + this.height / 2, 0));
            }
        }

        powerUp() {
            if (this.powerLevel === 0) {
                this.powerLevel = 1;
                this.maxBullets = 8;
                statusBoard.innerText = "LEVEL 2: MAX 8 SHOTS!";
                statusBoard.style.color = "#00ff00";
            } else if (this.powerLevel === 1) {
                this.powerLevel = 2;
                this.maxBullets = 12; // 3WAYÁî®„Å´Â∞ë„Åó‰∏äÈôê„ÇíÁ∑©„ÇÅ„Çã
                statusBoard.innerText = "LEVEL MAX: 3-WAY SHOT!";
                statusBoard.style.color = "#ff00ff";
            }
        }

        draw() {
            ctx.fillStyle = this.color;
            ctx.beginPath();
            ctx.moveTo(this.x + this.width, this.y + this.height / 2);
            ctx.lineTo(this.x, this.y);
            ctx.lineTo(this.x + 10, this.y + this.height / 2);
            ctx.lineTo(this.x, this.y + this.height);
            ctx.closePath();
            ctx.fill();
        }
    }

    // Âºæ„ÇØ„É©„Çπ
    class Bullet {
        constructor(x, y, vy) {
            this.x = x;
            this.y = y;
            this.vy = vy; // ‰∏ä‰∏ã„ÅÆÈÄüÂ∫¶
            this.width = 10;
            this.height = 4;
            this.speed = 10;
            this.color = '#ffff00';
            this.markedForDeletion = false;
        }

        update() {
            this.x += this.speed;
            this.y += this.vy;
            // ÁîªÈù¢Â§ñ„Å´Âá∫„Åü„ÇâÊ∂à„Åô
            if (this.x > canvas.width || this.y < 0 || this.y > canvas.height) {
                this.markedForDeletion = true;
            }
        }

        draw() {
            ctx.fillStyle = this.color;
            ctx.fillRect(this.x, this.y - this.height/2, this.width, this.height);
        }
    }

    // Êïµ„ÇØ„É©„Çπ
    class Enemy {
        constructor(isItemCarrier) {
            this.width = 30;
            this.height = 30;
            this.x = canvas.width;
            this.y = Math.random() * (canvas.height - this.height);
            this.speed = Math.random() * 2 + 1; // Â∞ë„Åó„ÇÜ„Å£„Åè„Çä„Å´
            this.markedForDeletion = false;
            
            this.isItemCarrier = isItemCarrier; // „Ç¢„Ç§„ÉÜ„É†ÊåÅ„Å°„Åã„Å©„ÅÜ„Åã
            this.color = isItemCarrier ? '#d000ff' : '#ff4444'; // „Ç¢„Ç§„ÉÜ„É†ÊåÅ„Å°„ÅØÁ¥´
        }

        update() {
            this.x -= this.speed;
            if (this.x + this.width < 0) this.markedForDeletion = true;
        }

        draw() {
            ctx.fillStyle = this.color;
            ctx.fillRect(this.x, this.y, this.width, this.height);
            // Êïµ„ÅÆÁõÆ
            ctx.fillStyle = 'white';
            ctx.fillRect(this.x + 5, this.y + 5, 5, 5);
            
            // „Ç¢„Ç§„ÉÜ„É†ÊåÅ„Å°„ÅØÊû†Á∑ö„Çí„Å§„Åë„Çã
            if (this.isItemCarrier) {
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.strokeRect(this.x, this.y, this.width, this.height);
            }
        }
    }

    // „Ç¢„Ç§„ÉÜ„É†„ÇØ„É©„Çπ
    class Item {
        constructor(x, y) {
            this.x = x;
            this.y = y;
            this.size = 20;
            this.speed = 2;
            this.markedForDeletion = false;
            this.text = "üç¨";
        }
        
        update() {
            this.x -= this.speed; // „ÇÜ„Å£„Åè„ÇäÂ∑¶„Å∏ÊµÅ„Çå„Çã
            if (this.x < 0) this.markedForDeletion = true;
        }

        draw() {
            ctx.font = '20px sans-serif';
            ctx.fillText(this.text, this.x, this.y + 20);
        }
    }

    // Êòü„ÇØ„É©„ÇπÔºàËÉåÊôØÔºâ
    class Star {
        constructor() {
            this.x = Math.random() * canvas.width;
            this.y = Math.random() * canvas.height;
            this.size = Math.random() * 2;
            this.speed = Math.random() * 3 + 0.5;
        }
        update() {
            this.x -= this.speed;
            if (this.x < 0) {
                this.x = canvas.width;
                this.y = Math.random() * canvas.height;
            }
        }
        draw() {
            ctx.fillStyle = 'white';
            ctx.fillRect(this.x, this.y, this.size, this.size);
        }
    }

    // „Ç§„É≥„Çπ„Çø„É≥„ÇπÁÆ°ÁêÜ
    const player = new Player();
    let bullets = [];
    let enemies = [];
    let items = [];
    let stars = [];

    for(let i=0; i<50; i++) stars.push(new Star());

    // Ë°ùÁ™ÅÂà§ÂÆö
    function checkCollision(rect1, rect2) {
        return (
            rect1.x < rect2.x + (rect2.width || rect2.size) &&
            rect1.x + (rect1.width || 40) > rect2.x &&
            rect1.y < rect2.y + (rect2.height || rect2.size) &&
            rect1.y + (rect1.height || 20) > rect2.y
        );
    }

    function animate() {
        if (gameOver) {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = 'white';
            ctx.font = '40px Courier New';
            ctx.textAlign = 'center';
            ctx.fillText("GAME OVER", canvas.width/2, canvas.height/2);
            ctx.font = '20px Courier New';
            ctx.fillText("Score: " + score, canvas.width/2, canvas.height/2 + 40);
            ctx.fillText("Press SPACE to Restart", canvas.width/2, canvas.height/2 + 80);
            return;
        }

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // ËÉåÊôØ
        stars.forEach(star => { star.update(); star.draw(); });

        // „Éó„É¨„Ç§„É§„Éº
        player.update();
        player.draw();

        // Âºæ
        bullets.forEach((bullet, index) => {
            bullet.update();
            bullet.draw();
            if (bullet.markedForDeletion) bullets.splice(index, 1);
        });

        // Êïµ„ÅÆÂá∫ÁèæÔºàÂá∫ÁèæÈ†ªÂ∫¶„Çí‰∏ã„Åí„Çã: 60 -> 90Ôºâ
        if (frameCount % 90 === 0) {
            // 20%„ÅÆÁ¢∫Áéá„Åß„Ç¢„Ç§„ÉÜ„É†ÊåÅ„Å°ÔºàÁ¥´Ôºâ„ÅåÂá∫Áèæ
            let isCarrier = Math.random() < 0.2;
            enemies.push(new Enemy(isCarrier));
        }

        // Êïµ„ÅÆÂá¶ÁêÜ
        enemies.forEach((enemy, eIndex) => {
            enemy.update();
            enemy.draw();

            // Âºæ vs Êïµ
            bullets.forEach((bullet, bIndex) => {
                if (checkCollision(bullet, enemy)) {
                    // „Ç¢„Ç§„ÉÜ„É†ÊåÅ„Å°„Å™„Çâ„Ç¢„Ç§„ÉÜ„É†„Éâ„É≠„ÉÉ„Éó
                    if (enemy.isItemCarrier) {
                        items.push(new Item(enemy.x, enemy.y));
                    }
                    
                    score += 100;
                    scoreBoard.innerText = "SCORE: " + score;
                    enemy.markedForDeletion = true;
                    bullet.markedForDeletion = true;
                }
            });

            // „Éó„É¨„Ç§„É§„Éº vs Êïµ
            if (checkCollision(player, enemy)) gameOver = true;

            if (enemy.markedForDeletion) enemies.splice(eIndex, 1);
        });

        // „Ç¢„Ç§„ÉÜ„É†„ÅÆÂá¶ÁêÜ
        items.forEach((item, iIndex) => {
            item.update();
            item.draw();

            // „Éó„É¨„Ç§„É§„Éº vs „Ç¢„Ç§„ÉÜ„É†
            if (checkCollision(player, item)) {
                player.powerUp(); // „Éë„ÉØ„Éº„Ç¢„ÉÉ„ÉóÂÆüË°å
                score += 500;
                scoreBoard.innerText = "SCORE: " + score;
                item.markedForDeletion = true;
            }

            if (item.markedForDeletion) items.splice(iIndex, 1);
        });

        frameCount++;
        requestAnimationFrame(animate);
    }

    animate();

</script>
</body>
</html>
